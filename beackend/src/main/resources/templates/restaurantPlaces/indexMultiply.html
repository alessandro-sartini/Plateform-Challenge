<!DOCTYPE html>
<html lang="it" data-bs-theme="dark" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Importa da Google | RestFinder</title>
  <th:block th:replace="~{fragments/utils :: style}" />
  <style>
    .badge-imported {
      background: #e74c3c!important;
      color: #fff!important;
      font-size: 0.95em;
      letter-spacing: 0.03em;
    }
    .card-google:hover { box-shadow: 0 8px 32px rgba(39,174,96,0.13)!important; border-color: #27ae60!important; }
  </style>
</head>
<body>
    <header>
      <th:block th:replace="~{fragments/utils :: navbar}" />
    </header>
  <div class="container my-5">
    <form th:action="@{/admin/google/restaurants}" method="get" class="mb-4 d-flex gap-2 flex-wrap">
      <input type="text" name="nome" th:value="${nome}" placeholder="Nome ristorante..." class="form-control" style="max-width:220px;">
      <input type="text" name="citta" th:value="${citta}" placeholder="Città..." class="form-control" style="max-width:220px;">
      <button type="submit" class="btn btn-success"><i class="bi bi-search"></i> Cerca</button>
    </form>
    <h2 class="mb-4 fw-bold">Seleziona Ristoranti da Salvare</h2>
    <form th:action="@{/admin/google/restaurants/salva-multipli}" method="post">
      <input type="hidden" name="citta" th:value="${citta}" />
      <input type="hidden" name="pagetoken" th:value="${pagetoken}" />
      <div class="row row-cols-1 row-cols-md-2 g-4 mb-4">
        <div th:each="rist, iter : ${ristorantiGoogle}" class="col">
          <div class="card card-google shadow-sm border-0 h-100">
            <div class="card-body">
              <div class="d-flex align-items-center mb-2">
                <h5 class="mb-0 flex-grow-1" th:text="${rist.name}">Nome ristorante</h5>
                <span class="badge badge-imported ms-2" th:if="${importedPlaceIds.contains(rist.placeId)}">Già importato</span>
              </div>
              <div class="mb-2 text-muted" th:text="${rist.formattedAddress}">Indirizzo completo</div>
              <div class="form-check mb-2">
                <input class="form-check-input fs-5" type="checkbox" th:name="selectedIndices" th:value="${iter.index}" th:disabled="${importedPlaceIds.contains(rist.placeId)}" id="ristChk__[[${iter.index}]]" />
                <label class="form-check-label" th:for="|ristChk__${iter.index}|">Seleziona per importare</label>
              </div>
              <input type="hidden" th:name="|ristoranti[${iter.index}].placeId|" th:value="${rist.placeId}"/>
              <input type="hidden" th:name="mapsUrl" th:value="${rist.url}" />
            </div>
          </div>
        </div>
      </div>
      <div class="d-flex justify-content-end">
        <button type="submit" class="btn btn-success btn-lg px-4 shadow"><i class="bi bi-cloud-upload"></i> Salva selezionati</button>
      </div>
    </form>
    <div th:if="${pagetoken}">
      <form th:action="@{/admin/google/restaurants}" method="get">
        <input type="hidden" name="citta" th:value="${citta}" />
        <input type="hidden" name="pagetoken" th:value="${pagetoken}" />
        <input type="hidden" name="nome" th:value="${nome}" />
        <button type="submit" class="btn btn-primary mt-3"><i class="bi bi-arrow-right-circle"></i> Pagina Successiva</button>
      </form>
    </div>
  </div>
  <script>
    document.querySelectorAll("form").forEach(form => {
      form.addEventListener("submit", function(e) {
        form.querySelectorAll('button[type="submit"]').forEach(btn => {
          btn.disabled = true;
          btn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> caricamento...';
        });
      });
    });
  </script>
  <th:block th:replace="fragments/utils :: js"/>
</body>
</html>
